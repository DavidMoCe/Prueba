<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario Personal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        form {
            max-width: 400px;
            margin: auto;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
        }
        button {
            margin-top: 20px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #bienvenida {
            display: none;
            text-align: center;
            font-size: 24px;
            color: green;
        }
        /* Estilos de la tarta */
        .cake-body{
            position:relative;
            margin:100px auto;
            width:200px;
        }
        .layer{
            display:block;
            height:50px;
            width:150px;
            border-bottom-right-radius:50%;
            border-bottom-left-radius:50%;
            position:absolute;
        }
        .f1{ top:90px; background:#774F38; height:60px; }
        .f2{ top:60px; background:#ECE5CE; height:60px; }
        .f3{ top:30px; background:#E08E79; height:60px; }
        .f4{
            border-top-right-radius:50%;
            border-top-left-radius:50%;
            background:#59280F;
            top:6px;
        }
        .spot-group{ display:block; height:14px; width:14px; position:absolute; }
        .spot{ display:block; height:4px; width:4px; border-radius:50%; position:absolute; }
        .f1 .spot{ background:#8C5F45; }
        .f2 .spot{ background:#D6CFB6; }
        .f3 .spot{ background:#EB9E8A; }
        .sg1{ bottom:20px; left:5px; }
        .sg2{ bottom:20px; right:10px; }
        .sg3{ bottom:21px; left:6px; }
        .sg4{ bottom:11px; right:33px; }
        .sg5{ bottom:15px; left:25px; }
        .drip-ctn{ position:absolute; top:0; left:0; width:150px; height:50px; z-index:1; }
        .drip{ display:block; height:20px; width:20px; border-radius:50%; background:#59280F; position:absolute; }
        .d1{ height:25px; top:20px; left:0px; }
        .d2{ top:30px; left:15px; }
        .d3{ top:35px; left:30px; }
        .d4{ top:38px; left:47px; }
        .d5{ top:40px; left:65px; }
        .d6{ top:38px; left:83px; }
        .d7{ top:35px; left:100px; }
        .d8{ top:30px; left:115px; }
        .d9{ height:25px; top:20px; left:130px; }
        .candle-ctn{ display:block; width:150px; height:80px; position:absolute; top:-30px; z-index:3; }
        .candle{ position:absolute; top:20px; }
        .c1 { left:40px; }
        .c2 { left:70px; }
        .c3 { left:100px; }
        .c-base{ display:block; height:30px; width:10px; background:#5FEDB5; position:absolute; z-index:2; }
        .wick{ display:block; width:2px; height:6px; background:#ccc; position:absolute; top:-5px; left:4px; }
        .flame{ display:block; height:16px; width:8px; border-radius:50% 50% 50% 50% / 60% 60% 40% 40%; background:#FF9E00; position:absolute; top:-20px; left:1px; box-shadow:0px 0px 20px yellow; -webkit-animation:flicker 2s infinite; }
        .flame.off { display:none; }
        .highlight{ display:block; height:30px; width:60px; border-radius:50%; position:absolute; top:17px; left:-25px; background: -webkit-radial-gradient(center, ellipse cover, rgba(145,66,26,1) 0%,rgba(105,47,18,0) 80%); z-index:1; -webkit-animation:highlight 2s infinite; }
        @-webkit-keyframes flicker { 0%{opacity:1} 50%{opacity:0.8} 100%{opacity:1} }
        @-webkit-keyframes highlight { 0%{opacity:1} 50%{opacity:0.9} 100%{opacity:1} }
        #startMic, #blowBtn{
          margin:10px auto;
          padding:10px 20px;
          font-size:16px;
          cursor:pointer;
        }
        #blowBtn{ margin-top:200px; }
        #gift{ display:none; text-align: justify; text-align: center; margin-top:20px; font-size:18px; }
        #horaBeso { margin-top: 20px; background-color: #b91010; color: white; }
    </style>
</head>
<body>

    <form id="miFormulario">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" name="nombre" required>

        <label for="personaFavorita">¿Quién es tu persona favorita?:</label>
        <input type="text" id="personaFavorita" name="personaFavorita" required>

        <label for="autoestima">¿Cuánto te quieres?:</label>
        <input type="number" id="autoestima" name="autoestima" min="70" max="100" required>

        <label for="feliz">¿Eres feliz? (Lo siento, solo puedes elegir si):</label>
        <select id="feliz" name="feliz" required>
            <option value="si">Sí</option>
        </select>

        <label for="fechaNacimiento">¿Cuándo naciste?:</label>
        <input type="date" id="fechaNacimiento" name="fechaNacimiento" required>

        <button type="submit">Enviar</button>
    </form>

    <div id="bienvenida">
        <p id="mensajeCumple">Andaa!!! ¿Es tu cumple?</p>
        <p id="fraseDeseo">Pide un deseo....Sopla fuerte</p>
        <div class="cake-body" id="cake">
            <div class="layer f1">
                <div class="spot-group sg1">
                    <div class="spot s1"></div>
                    <div class="spot s2"></div>
                    <div class="spot s3"></div>
                </div>
                <div class="spot-group sg2">
                    <div class="spot s1"></div>
                    <div class="spot s2"></div>
                </div>
            </div>
            <div class="layer f2">
                <div class="spot-group sg3">
                    <div class="spot s1"></div>
                    <div class="spot s2"></div>
                </div>
                <div class="spot-group sg4">
                    <div class="spot s1"></div>
                    <div class="spot s2"></div>
                    <div class="spot s3"></div>
                </div>
            </div>
            <div class="layer f3">
                <div class="spot-group sg5">
                    <div class="spot s1"></div>
                    <div class="spot s2"></div>
                    <div class="spot s3"></div>
                </div>
            </div>
            <div class="layer f4">
              <div class="drip-ctn">
                <div class="drip d1"></div>
                <div class="drip d2"></div>
                <div class="drip d3"></div>
                <div class="drip d4"></div>
                <div class="drip d5"></div>
                <div class="drip d6"></div>
                <div class="drip d7"></div>
                <div class="drip d8"></div>
                <div class="drip d9"></div>
              </div>
            </div>

            <div class="candle-ctn">
              <div class="candle c1">
                <div class="c-base"></div>
                <div class="wick"></div>
                <div class="flame"></div>
                <div class="highlight"></div>
              </div>
              <div class="candle c2">
                <div class="c-base"></div>
                <div class="wick"></div>
                <div class="flame"></div>
                <div class="highlight"></div>
              </div>
              <div class="candle c3">
                <div class="c-base"></div>
                <div class="wick"></div>
                <div class="flame"></div>
                <div class="highlight"></div>
              </div>
            </div>
        </div>
        <button id="startMic">Activar micrófono</button>
        <button id="blowBtn">Apaga las velas</button>
        <div id="gift">
            <p>Seguro de que se cumplirá tu deseo, lo estas haciendo muy bien, te estas esforzando un montón y eso se nota. 
                A pesar de los malos momentos que tu muy bien sabes, estas saliendo adelante y aunque a veces se complica todo y se hace cuesta arriba, siempre hay alguien que te quiere y te va a apoyar siempre, seguramente lo tengas al lado asi que...dale un beso,shh entre nosotros...a veces es un poco borde pero se le quiere y el también. 
                Al final también hay cosas buenas en el año y al lado tienes a una de ellas asi que...durante 5 segundos al menos dale un beso de verdad.</p>
            <button id="horaBeso">Hora del beso</button>
        </div>
    </div>

    <script>
        const formulario = document.getElementById('miFormulario');
        const bienvenida = document.getElementById('bienvenida');

        formulario.addEventListener('submit', function(event) {
            event.preventDefault(); // Evitar envío por defecto

            const nombre = document.getElementById('nombre').value.trim();
            const fecha = document.getElementById('fechaNacimiento').value; // Formato YYYY-MM-DD

            // Validar nombre
            if (nombre !== "Cristina" && nombre !== "cristina") {
                alert("Usuario no autorizado.");
                return;
            }

            // Validar fecha
            if (fecha !== "2002-11-19") {
                alert("Muchas gracias que tenga buen día");
                return;
            }

            // Si todo está bien y fecha coincide, ocultar formulario y mostrar bienvenida con tarta
            formulario.style.display = 'none';
            bienvenida.style.display = 'block';
        });

        // Script de la tarta
        document.addEventListener('DOMContentLoaded', function(){
            let flames = document.querySelectorAll('.flame');
            let cake = document.getElementById('cake');
            let gift = document.getElementById('gift');
            let blowBtn = document.getElementById('blowBtn');
            let startMic = document.getElementById('startMic');
            let mensajeCumple = document.getElementById('mensajeCumple');
            let fraseDeseo = document.getElementById('fraseDeseo');
            let horaBeso = document.getElementById('horaBeso');

            function blowOut(){
                flames.forEach(f=>f.classList.add('off'));
                setTimeout(()=>{
                    cake.style.display='none';
                    startMic.style.display='none';
                    blowBtn.style.display='none';
                    gift.style.display='block';
                    mensajeCumple.style.display='none'; // Ocultar mensaje
                    fraseDeseo.style.display='none'; // Ocultar frase
                }, 3000);
            }

            startMic.addEventListener('click', ()=>{
                navigator.mediaDevices.getUserMedia({audio:true})
                .then(stream=>{
                    startMic.style.display='none';
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const mic = audioContext.createMediaStreamSource(stream);
                    const analyser = audioContext.createAnalyser();
                    analyser.fftSize=1024;
                    mic.connect(analyser);
                    const dataArray = new Uint8Array(analyser.frequencyBinCount);

                    function checkBlow(){
                        analyser.getByteFrequencyData(dataArray);
                        let volume = dataArray.reduce((a,b)=>a+b)/dataArray.length;
                        if(volume>60){ blowOut(); } // Umbral reducido a 60
                        requestAnimationFrame(checkBlow);
                    }
                    checkBlow();
                })
                .catch(err=>{
                    blowBtn.style.display='block';
                    startMic.style.display='none';
                });
            });

            blowBtn.addEventListener('click', blowOut);

            // Evento para el botón "Hora del beso"
            horaBeso.addEventListener('click', function() {
                horaBeso.style.display = 'none'; // Ocultar el botón
                setTimeout(() => {
                    // Mostrar la frase después de 5 segundos
                    gift.innerHTML = '<p>Oye Cristina!!! Te creías que esto es todo? Hay algo más todavía.</p>';
                    
                    // Después de otros 5 segundos (total 10 desde el clic), mostrar el regalo
                    setTimeout(() => {
                        // Agregar estilos del regalo al head
                        const styles = `
                            body {
                                background: #333;
                                padding-top: 150px;
                                text-align: center;
                                font-family: Arial, sans-serif;
                            }
                            .regalo {
                                width: 410px;
                                margin: 0 auto;
                                cursor: pointer;
                            }
                            .caja, .tapa {
                                background:
                                    -webkit-radial-gradient(white 10%, transparent 15.1%),
                                    -webkit-radial-gradient(white 7%, transparent 15.1%),
                                #f80000;
                                background-position: 0 0, 25px 25px;
                                background-size: 50px 50px;
                                position: relative;
                                margin: 0 auto;
                            }
                            .caja {
                                width: 400px;
                                height: 250px;
                            }
                            .tapa {
                                width: 400px;
                                height: 70px;
                                box-shadow: 1px 2px 3px rgba(0,0,0,0.2);
                                z-index: 1;
                                padding: 0 2px;
                                background-color: #f80000;
                                top: 0;
                                left: 0;
                                transition: 
                                    top ease-out 0.5s,
                                    left ease-out 0.5s,
                                    transform ease-out 0.5s;
                            }
                            .caja span, .tapa span {
                                position: absolute;
                                display: block;
                                background: rgba(239, 184, 16, 0.8);
                                box-shadow: 1px 2px 3px rgba(0,0,0,0.1);
                            }
                            .caja span:first-child {
                                width: 100%;
                                height: 60px;
                                top: 80px;
                            }
                            .caja span:last-child, .tapa span {
                                width: 60px;
                                height: 100%;
                                left: 170px;
                            }
                            .tapa span {
                                left: 172px;
                            }
                            .promo {
                                font-size: 30px;
                                color: white;
                                font-family: Georgia, 'Times New Roman', Times, serif;
                                text-align: center;
                                position: relative;
                                height: 0;
                                top: 10px;
                                transition: all ease-out 0.7s;
                            }
                            .promo p {
                                font-size: 24px;
                                margin: 0;
                            }
                            .promo h2 {
                                font-size: 40px;
                                margin: 0;
                            }
                            /* Efecto hover */
                            .regalo:hover .tapa {
                                top: -100px;
                                transform: rotateZ(10deg);
                                left: 10px;
                            }
                            .regalo:hover .promo {
                                top: -80px;
                            }
                            /* BOTÓN */
                            .btn-tiradas {
                                margin-top: 40px;
                                padding: 15px 30px;
                                background: #f80000;
                                color: white;
                                font-size: 20px;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                transition: background 0.3s ease;
                            }
                            .btn-tiradas:hover {
                                background: #ff4d4d;
                            }
                        `;
                        document.head.insertAdjacentHTML('beforeend', '<style>' + styles + '</style>');
                        
                        // Cambiar estilos del body para el regalo
                        document.body.style.background = '#333';
                        document.body.style.paddingTop = '150px';
                        document.body.style.textAlign = 'center';
                        
                        // Reemplazar el contenido del gift con el regalo animado
                        gift.innerHTML = `
                            <div class="regalo">
                                <div class="tapa">
                                    <span></span>
                                </div>
                                <div class="promo">
                                    <p>3 Tiradas gratis</p>
                                    <h2>1 Tirada de bonus</h2>
                                </div>
                                <div class="caja">
                                    <span></span>
                                    <span></span>
                                </div>
                            </div>
                            <!-- BOTÓN -->
                            <button class="btn-tiradas">Realizar tiradas</button>
                        `;
                    }, 5000); // 5 segundos después de la frase
                }, 5000); // Primeros 5 segundos para la frase
            });
        });
    </script>